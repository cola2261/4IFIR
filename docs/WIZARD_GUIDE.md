# Гайд по настройке 4IFIR WIZARD

1. [Предварительные оптимизации](#предварительные-оптимизации)
1. [CPU](#CPU)  
1. [GPU](#GPU)  
1. [RAM](#RAM)  
1. [4ifir Optimised (ECO режим)](#профиль-emc-4ifir-optimised)  

## Советы перед настройкой
* Используйте EMUNAND
* Сделайте бекап сохранений 
* Установите игры для проверки стабильности настроек
* Текущие параметры, установленные в 4IFIR WIZARD, хранятся в файле atmosphere\kips\loader.kip
* Если после изменения какого-то из параметров перестала включаться консоль - верните предыдущее значение через safe-mode
* Если не получилось откатить изменения через safe-mode, то используйте KipTool - это payload-based инструмент, позволяющий редактировать значение параметров в вашем `loader.kip` файле.
Инструкцию по установке и использованию можно найти на [странице проекта](https://github.com/kawaii-flesh/KipTool)
* Если у вас нет возможности зайти в семи-сток и при этом консоль не запускается после настройки в **4IFIR Wizard**, можно заменить файл `atmosphere/kips/loader.kip` на бэкап вашего предыдущего кипа, *не забудьте переименовать файл бэкапа в `loader.kip`*. Бэкапы кипов находятся в папке `atmosphere/kips/.bak` (включите невидимые папки в проводнике). Если бэкапов нет, можно достать стандартный `loader.kip` с вашей версии 4IFIR в папке `atmosphere/kips/loader.kip`.  
* Следует установить HB Menu как приложение [.nsp файл по ссылке](https://t.me/kf4fr/48074/547847). Далее все манипуляции и тесты следует проводить именно в нем.
* Для проверки параметров на стабильность, сначала запускаем - MicroMemBench. Если все ОК, то можно переходить к тестам в игре, для этого хорошо подойдет Red Dead Redemption, игра хорошо нагружает консоль.
Для большей нагрузки, можно перевести консоль в docked mode с помощью ReversNX. Для каждого теста будет достаточно 15-20 минут игры.

## 4IFIR WIZARD

### Предварительные оптимизации
**Применив эти настройки можно добиться прироста до 500 мб/с**
* **Smart mode - QuickTune - eBamatic - e.BAMATIC Stage** - выбор уровня оптимизаций eBamatic. Чем выше значение, тем агрессивнее оптимизация.
>Поочередно повышаете значения на шаг и тестируете на стабильность. MemBench + Игра  
* **4advanced-4ekate** – Бесплатный прирост (около 200 мб/с) при выборе ST2. (Работает не у всех, могут появиться проблемы с выходом консоли из сна)
>Тестировать ненадо, либо работет, либо - нет  
>**ВАЖНО!!!** В данный момент включение ST 2, стоит делать в [KipTool](https://github.com/kawaii-flesh/KipTool/releases/), так как включение ST2 через Wizard - вызывает проблемы со сном.

### CPU
>Все пункты в данном разделе, тестируйте с включенным профилем EMC - 4IFIR optimised S. 

Начать рекоммендую с настроек CPU, так как CPU не зависит от RAM и GPU. Поэтому даже если вы в будующем захотите сделать себе новый кип (более экономичный или более производительный), то раздел CPU вам перенастраивать не придется.    
Если какой то из параметров будет "перекручен", то консоль скорее всего просто зависнет после лого атмосферы. Поэтому загружаемся в СейфМод и возвращаем параметр в предыдущее значение  
`По хорошему, в данном разделе, в настроках нуждаются только 2 параметра: **CPU Minimal Voltage и Low Mhz Undervolt**  
Те параметры, у которых по умолчанию стоит значение - eBamatic можно и не трогать, так как ощутимого профита вы не получите, но своё время потратите`
***
**Переходим в 4advanced - CPU**
* CPU Minimal Voltage – выбор нижнего порога потребления процессора.   
>Чем ниже напряжение, тем меньше потребление. Выставляем его на шаг ниже (например, было 620, стало 590 мВ). Перезагружаем систему и проводим тесты.  
>Тесты проводим в играх, выставляя минимальную частоту через    
>4IFIR Houdini -> Temporary overrides (после установки разгона в этом пункте, он будет работать до перезагрузки консоли) -> CPU  
>Если все хорошо, опускаем напряжение еще ниже и так далее, пока система работает.     
>Фиксируем значение и оставляем его.
* Low Mhz Undervolt – уровни андервольта для частот процессора ниже <=15хх Mhz.  
>Чем выше значение, тем ниже потребление на частотах до 15ххMHz. Выставляем на шаг выше, тестируем в играх на частотах до 15ххMHz с выключенным Governor    
>4IFIR Houdini -> Edit app Profile -> CPU Freq Governor -> Off    
>Повышаем значения до тех пор пока работает.     
* CPU Maximum Voltage – выбор верхнего порога потребления процессора.  
**Рекомендуется оставить значение eBamatic**    
>Устанавливаем значение - 1150мв, перезагружаемся и тестируем в CPU-зависимых играх (RDR, Hogwarts Legacy, No Man's Sky) в режиме 4IFIR Maximized на CPU.  
>Понижаем напряжение на 1 шаг и снова тестируем. Так делаем до тех пор, пока все работает.   `
* dCPUv - корректировка напряжений в диапазоне частот от 12хх до 18хх MHz  
**Рекомендуется оставить значение eBamatic**
>Действовать нужно с осторожностью и на свой страх и риск. Хотя катастрофических последствий быть не должно, ошибки в работе игры и операционной системы возможны.
  Перед редактированием рекомендуется сделать бекап конфигурации, чтобы не пересоздавать ее заново. Откатить изменения в конфигураторе не получится.
  За отправную точку можно взять напряжение 780mV и затем снижать или повышать его на один шаг по мере прохождения тестов (чем меньше напряжение, тем меньше потребление).
  Обязательно протестируйте работу с разгоном оперативной памяти и отключенным CPU Freq Governor в диапазоне частот 12хх-18ххMHz в CPU-интенсивных играх!
* CPU Boost Clock – выбор частоты до которой будет разгонятся игра на загрузочных экранах.  
**Рекомендуется оставить значение eBamatic**
>Можно выставить максимальное значение, но eBamatic - стабильнее 
* High Mhz Undervolt – уровни андервольта для частот процессора выше >15хх Mhz.    
**Рекомендуется оставить значение eBamatic**  
>Чем выше значение, тем ниже потребление на частотах выше 15xxMhz. 
>Выставляем на шаг выше, тестируем в CPU зависимых играх (Metro, Hogwarts Legacy, No Man's sky) на частотах выше 15ххMHz с выключенным Governor. Повышаем до тех пор, пока все работает. Рекомендуется тестировать в режиме 4IFIR MAXIMIZED:  
>4IFIR Houdini -> Temporary overrides -> CPU -> 4IFIR MAXIMIZED
* Speed Shift - понижение напряжения (потребления) вторичных компонентов консоли. Чем выше значение, тем ниже потребление.  
 **Рекомендуется оставить значение eBamatic**
>Чем выше значение, тем ниже потребление 
>Выставляем на шаг выше, тестируем

### GPU
>Все пункты в данном разделе, тестируйте с включенным профилем EMC - 4IFIR optimised S.
  
Далее можно перейти к настройке GPU   
Тесты можно проводить только в играх, так как MemBench не задействует GPU
Принцип работы волтажей GPU:
GPUv Min - зависит от текущей частоты RAM, но так как теперь этот параметр адаптивный, то заморачиваться на этом не стоит. (для справки)
На вольтажи GPU влияют 2 параметра - GPUv Min (1й приоритет) и Gpu Eco Mode (2й приоритет);  
От самой минимальной частоты GPU - до *xxx*MHz (это частота которую предстоит вычислить опытным путем) используются вольтажи GPUv Min  
На всех остальных частотах GPU используются вольтажи из таблицы Gpu Eco Mode  
Ошибки связаные с "перекручеными" настройками GPU, обычно выглядят в виде артефактов в играх(нарушение целостности текстур, непонятные сверкающие точки, изменение текстур). Так же могут сопровождаться оранжевым экраном.
***
**Переходим в раздел SmartMode-QuickTune-GPU**
* GPUv Mode – уровни самого минимального значения потребления видеокарты.   
>Чем выше Stage, тем ниже напряжение и меньше потребление.    
>Повышаем значение на шаг и перезагружаемся. Система работает? Отлично!  
>Запускаем GPU-интенсивные игры (RDR, No Man's Sky, Hogwarts Legacy).  
>Теперь мы в игре и должны узнать, до какой частоты работает наш GPU при минимальном напряжении, которое мы выставили в этом пункте. Но перед этим, для тестов, нужно отключить GPU Freq Governor: 4IFIR Houdini -> Edit app Profile -> GPU Freq Governor -> Off;  
>Устанавливаем частоту GPU: 4IFIR Houdini -> Temporary overrides -> GPU -> *xxx*MHz;  
>Можем начинать со значения 460MHz. Установили, двигаемся в 4IFIR Houdini -> Miscellaneous; Спускаемся в самый низ и фиксируем значение GPU volt: *xxx*MHz, где xxx - ваше текущее напряжение. (**Данный показатель меняется в зависимости от частоты RAM**)    
>Возвращаемся в Temporary overrides и увеличиваем частоту GPU на один шаг.  
>Проверяем напряжение GPU в Miscellaneous, повторяя эту процедуру до тех пор, пока напряжение не изменится.  
>После этого уменьшаем частоту GPU на один шаг от предельного значения.
>  
>_Пример (случайные значения):  
>частота гпу 72х - 590мв  
>частота гпу 768 - 590мв  
>частота гпу 8хх - 600мв  
>Проводим тесты на 72х._
>  
>Таким образом, мы определили максимальную частоту при минимальном напряжении.  
>Теперь можно протестировать игры на этой частоте, обязательно с включенным разгоном RAM. 5-10 минут игры в нескольких играх будет достаточно.  
>Если на каком-либо этапе повышения частоты или теста в игре происходит сбой или зависание, снижаем GPUv. Если нет - повышаем и тестируем дальше.  
* Gpu Eco Mode – выбор уровня андервольта на всей сетке частот видеокарты (чем выше тем агрессивнее андервольт).
>Чем выше значение, тем ниже потребление на частотах выше тех, на которых работает GPUv Mode (Определяли в предыдущем шаге), следовательно и тесты нужно проводить на этих частотах. Рекомендуется также тестировать с выключенным GPU Freq Governor, тестируя примерно 5-10 минут. Если все хорошо, повышаем GPU Eco Mode и тестируем. Если нет - понижаем. _(если не поняли на какой частоте тестировать, тестируйте на 4ifir optimised, это не совсем правильно, но пойдет)_
* GPU Overvolt - уровни максимального значения потребления видеокарты
>Оставляем eBamatic, так как профита от утановки вручную вы не получите

### RAM
Для начала стоит определиться со сценарием использования консоли, от этого и будет зависеть выбор частоты RAM  
1. Эко режим  - для 30 фпс с низким потреблением. Частоты до 2000 Mhz; Не совсем уверен, есть ли смысл его сейчас настраивать, так как есть профиль RAM 4IFIR optimized E, при должной настройки, у него не плохая производительность (об этом чуть позже)
2. Сбалансированый - это 60 фпс (не всегда стабильных), но с приемлемым потреблением. Частоты 2100 - 2400 Mhz будут оптимальным выбором для такого сценария
3. Максимальная производительность - режим для игры в доке; тут может быть любая частота от 2400 и до скольки получится
Если выбраная вами частота не заводится - попробуйте вручную повысить eBalance (eBal), чем выше значение eBal, тем выше частоту можно взять.
***
**Переходим в 4advanced - RAM**  
* RAM Mhz – выбор частоты памяти, которая будет доступна в меню разгона приставки 4IFIR Houdini>Edit app profile/Temporary overrides/Global profile>Memory>4IFIR Optimized S.  
>Выбираем нужную частоту, перезагружаемся (шаг назад, пункт Complete[Reboot])  
>После загрузки активируем разгон памяти:  
>4IFIR Houdini -> Temporary overrides -> Memory -> 4IFIR Optimized S  
>Это временный разгон, который слетит после перезагрузки.    
>В шапке оверлея в графе MEM: *xxxx*MHz должно появиться ваше значение. Если все в порядке и консоль не зависла - идём дальше, если нет - жмём кнопку питания консоли 12 секунд до выключения, грузимся через хекату в сейф-мод и выбираем значение RAM в Wizard на ступень ниже.    
>Тесты на стабильность: MemBench - прогнать несколько раз и зафиксировать значения  
>Игры (важно). Тестируем в течение 10-15 минут в чувствительных к RAM играх (RDR). Если все хорошо (нет артефактов и зависаний), переходим дальше. Если нет - выбираем частоту RAM на ступень ниже.
* Ebalance – набор оптимизаций работы памяти в соотношении энергоэффективность производительность.  
>Чем выше eBAL, тем выше можно взять частоту RAM.      
>0 - eBamatic - авто, его можно и оставить, от достаточно хорош.  
>1 - Этот режим имеет максимальную производительность, но за счет более высокого VDDQ, по сравнению с 2м режимом. Профитнее всего его использовать на низких чатотах RAM (до 2000mhz) так как повышеный вольтаж, не сильно влияет   
>2 - Это Менее производительный, но так же более экономный (в сравнении с eBal 1); Маст-хэв для частот, выше 2000 Mhz  
>3 - Это Менее производительный (в сравнении с eBal 2), но позволяет взять выше частоту RAM  
>4 - Это Менее производительный (в сравнении с eBal 3), но позволяет взять еще выше частоту RAM     
>Чем ниже значение (исключение - eBal 1, тут другая логика), тем больше преимуществ вы получаете (увеличится пропускная способность памяти, что является мерилом производительности свича).       
>Если значение 2 работает, попробуйте протестировать его в MemBench и сравнить с предыдущими результатами. Если результаты улучшились, перейдите к MemTest и проверьте производительность в играх.       
* RAM Vddq – Напряжение питания памяти. Чем ниже значение, тем ниже потребление.  
>Поочередно снижаете значения на шаг вниз и тестируете на стабильность.  
* RAM Vdd2 – Выбор максимального порога потребления памяти. Чем ниже значение, тем ниже потребление.   
>Поочередно снижаете значения на шаг вниз и тестируете на стабильность.   
* Eba-shift - Корректировка eBal режима  
>При установки значения в 2, позволяет поднять значение 8-го тайминга (не у всех)    
* EMC DVB Mode - Эта настройка управляет внутренним адаптивным механизмом контроллера оперативной памяти. Выбор более точного значения потребления  
>по умолчанию стоит eBamatic, от ручной настройки профита не будет  
* Core Timings – Настройка таймингов памяти.  
Вариант настройки таймингов в режиме реального времени через - [**EMC Magician**](EMC_MAGICIAN.md)  
>Имеется восемь таймингов Core Timings 1–8. Тайминги не влияют друг на друга. Настройте каждый параметр по отдельности для достижения максимальной стабильной производительности. Чем выше значение каждого тайминга, тем выше производительность.    
>Начинаем с теста в MemBench - фиксируем результат. Переходим к первому таймингу, повышаем его на один шаг, перезапускаем консоль, тестируем в MemBench несколько раз и фиксируем новый результат, если показатель в MemBench улучшился, то продолжаем повышать и тестировать.
>Когда достигаем значения, при котором консоль начинает работать нестабильно, зависать или вылетать, возвращаемся к предыдущему значению и переходим к тесту в играх. Также может существовать порог, при котором дальнейшее повышение значения тайминга не даст никакого результата. (погрешность в 30-40 мб/с можно не учитывать, так как может быть ситуация: на значении 4 - 7650мб/с; на 5 - 7610мб/с; а на 6 значении может стать -7690мб/с. Но к примеру, если на 5м значении показатели упадут, до 7100мбс, тогда уже имеет смысл остаться на 4). На этом значении можно переходить к следующему таймингу. Остальные тайминги настраиваются по тому же алгоритму.


### pMeh и sMeh - на которые стоит обратить внимание
* pMeh 21 - корректировка значения GPU vMin для 4ifir Optimised S (Чем выше значение, тем ниже минимальный вольтаж, для мониторинга значений используйте InfoNX)

### Профиль EMC-4ifir Optimised

Настройки для режима **EMC-4IFIR Optimized**  
Тестировать так же как и ранее  
* pMeh 19 - GPU vMin для 4ifir Optimised (Чем выше значение, тем ниже минимальный вольтаж, для мониторинга значений используйте InfoNX)
* pMeh 20 - VDDQ/VDD2 для 4ifir Optimised (Чем выше значение, тем выше вольтаж, для мониторинга значений используйте InfoNX)
* sMeh 16 - устанавливет значение EMC-Optimized - 1600 МГц.
* sMeh 8 - стейджи эффективности памяти в режиме Optimized. Чем выше значение, тем больше производительности.

